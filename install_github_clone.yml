---
- import_tasks: github_repodata.yml

- name: Install GitHub Clone
  block:
    - debug:
        msg: "Installing {{ tool }} from {{ repo }} {{ release_ref }}"

    - name: Clone Repository
      git:
        repo: https://github.com/{{ repo }}.git
        dest: "{{ opt_dir }}/{{ dest }}"
        version: "{{ release_ref }}"

    - name: Link Files
      file:
        src: "{{ opt_dir }}/{{ dest }}/{{ l.src }}"
        dest: "{{ l.dest }}"
        state: link
      loop: "{{ link }}"
      loop_control:
        loop_var: l

    - set_fact:
        installed_ref: "{{ release_ref }}"
  when: release_ref != installed_ref | default('')
